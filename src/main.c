#include <stm32f031x6.h>
#include "display.h"
#include "sound.h"
#include "musical_notes.h"
#include "serial.h"

void initClock(void);
void initSysTick(void);
void SysTick_Handler(void);
void delay(volatile uint32_t dly);
void setupIO();
int isInside(uint16_t x1, uint16_t y1, uint16_t w, uint16_t h, uint16_t px, uint16_t py);
void enablePullUp(GPIO_TypeDef *Port, uint32_t BitNumber);
void pinMode(GPIO_TypeDef *Port, uint32_t BitNumber, uint32_t Mode);
volatile uint32_t milliseconds;
#define tune_length 87
#define SCREEN_WIDTH 128
#define SCREEN_HEIGHT 160

const uint16_t mouse1[]=
{
	32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,0,0,0,32776,0,0,32776,32776,32776,32776,32776,32776,32776,32776,32776,0,16383,16383,65535,0,61307,61307,0,32776,32776,32776,32776,32776,32776,32776,32776,0,16383,16383,65535,0,61307,61307,0,32776,32776,32776,0,32776,32776,32776,32776,0,16383,16383,29861,29861,29861,29861,29861,0,32776,0,16383,0,32776,32776,32776,0,0,16383,16383,29861,58640,29861,58640,0,32776,32776,0,16383,0,0,0,61307,61307,61307,29861,29861,29861,29861,29861,64923,0,32776,32776,0,16383,16383,61307,61307,61307,61307,61307,29861,29861,16383,16383,0,32776,32776,32776,32776,0,0,61307,61307,61307,61307,61307,61307,61307,61307,0,32776,32776,32776,32776,32776,32776,32776,0,0,61307,0,0,0,61307,61307,0,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,
};
const uint16_t mouse2[]= 
{
	32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,0,0,0,32776,0,0,32776,32776,32776,32776,32776,32776,32776,32776,32776,0,63668,63668,29861,0,61307,61307,0,32776,32776,32776,32776,32776,32776,32776,32776,0,63668,63668,29861,29861,29861,29861,29861,0,32776,32776,32776,32776,32776,32776,32776,32776,0,63668,63668,29861,58640,29861,58640,0,32776,32776,32776,32776,32776,32776,32776,0,61307,61307,29861,29861,29861,29861,29861,0,32776,32776,32776,32776,0,0,0,61307,61307,61307,61307,29861,29861,63668,63668,64923,0,32776,32776,0,63668,63668,61307,61307,61307,61307,61307,61307,61307,61307,0,0,32776,32776,0,63668,0,0,61307,61307,61307,0,0,61307,61307,0,32776,32776,32776,0,63668,0,32776,32776,0,61307,0,32776,32776,32776,32776,32776,32776,32776,32776,32776,0,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,
};
const uint16_t mouse3[]=
{
	32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,0,0,0,32776,0,0,32776,32776,32776,32776,0,32776,32776,32776,32776,0,63668,63668,29861,0,61307,61307,0,32776,32776,0,63668,0,32776,32776,32776,0,63668,63668,29861,0,61307,61307,0,32776,32776,32776,0,63668,0,0,0,0,63668,63668,29861,29861,29861,29861,29861,0,32776,32776,32776,0,63668,63668,61307,0,0,63668,63668,29861,58640,29861,58640,64923,0,32776,32776,32776,0,0,61307,61307,61307,61307,29861,29861,29861,29861,29861,0,32776,32776,32776,32776,32776,32776,0,61307,61307,61307,61307,29861,29861,63668,63668,0,32776,32776,32776,32776,32776,32776,0,61307,0,0,61307,61307,61307,61307,0,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,0,0,61307,61307,0,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,
};
const uint16_t mousedown1[]= 
{
	32776,32776,32776,32776,32776,32776,32776,32776,32776,0,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,0,16383,0,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,0,16383,0,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,0,0,16383,0,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,0,29861,29861,29861,29861,0,32776,32776,32776,32776,32776,32776,32776,32776,32776,0,61307,29861,29861,29861,29861,61307,0,32776,32776,32776,32776,32776,32776,32776,32776,0,29861,29861,61307,29861,29861,29861,0,32776,32776,32776,32776,32776,32776,32776,32776,0,29861,61307,61307,29861,61307,61307,0,32776,32776,32776,32776,32776,32776,32776,32776,32776,0,0,29861,61307,0,0,32776,32776,32776,32776,32776,32776,32776,32776,32776,0,27747,4228,0,0,27747,4228,0,32776,32776,32776,32776,32776,32776,32776,0,4228,27747,27747,27747,27747,27747,27747,27747,0,32776,32776,32776,32776,32776,32776,32776,0,29861,58640,29861,29861,58640,29861,0,32776,32776,32776,32776,32776,32776,32776,32776,0,29861,58640,29861,29861,58640,29861,0,32776,32776,32776,32776,32776,32776,32776,32776,32776,0,29861,29861,29861,29861,0,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,0,64923,64923,0,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,0,0,32776,32776,32776,32776,32776,32776,32776,
};
const uint16_t mousedown2[]= 
{
	32776,32776,32776,32776,32776,32776,0,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,0,16383,0,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,0,16383,0,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,0,16383,0,0,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,0,29861,29861,29861,29861,0,32776,32776,32776,32776,32776,32776,32776,32776,32776,0,61307,29861,29861,29861,29861,61307,0,32776,32776,32776,32776,32776,32776,32776,32776,0,29861,29861,61307,29861,29861,29861,0,32776,32776,32776,32776,32776,32776,32776,32776,0,29861,61307,61307,29861,61307,61307,0,32776,32776,32776,32776,32776,32776,32776,32776,32776,0,0,29861,61307,0,0,32776,32776,32776,32776,32776,32776,32776,32776,32776,0,27747,4228,0,0,27747,4228,0,32776,32776,32776,32776,32776,32776,32776,0,4228,27747,27747,27747,27747,27747,27747,27747,0,32776,32776,32776,32776,32776,32776,32776,0,29861,58640,29861,29861,58640,29861,0,32776,32776,32776,32776,32776,32776,32776,32776,0,29861,58640,29861,29861,58640,29861,0,32776,32776,32776,32776,32776,32776,32776,32776,32776,0,29861,29861,29861,29861,0,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,0,64923,64923,0,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,32776,0,0,32776,32776,32776,32776,32776,32776,32776,
};
const uint16_t poof0[]=
{
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,65315,1024,3088,1544,0,0,0,0,0,0,0,0,0,1024,65315,5144,47648,29976,4368,2568,2056,0,0,0,0,0,0,24327,4112,4368,65315,40224,24327,65315,4368,65315,1280,2056,0,0,0,0,3856,4368,65315,40224,40224,65315,65315,29976,4368,3344,4368,0,0,0,0,4368,4368,65315,40224,16142,16142,16142,32032,65315,24327,0,0,0,0,0,4112,4368,32032,16142,24327,16142,24327,40224,32032,4368,0,0,0,0,0,2056,4368,65315,40224,16142,16142,65315,40224,65315,4368,65315,0,0,0,0,0,4112,4368,46616,24327,40224,65315,40224,14360,4368,4368,0,0,0,0,0,24327,4368,4368,65315,65315,14360,24327,65315,65315,4368,0,0,0,0,0,2568,4368,65315,4368,4368,4368,4368,4368,4368,0,4368,0,0,0,0,0,0,2056,4368,65315,4368,4368,0,65315,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
};
const uint16_t poof1[]=
{
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,65315,4368,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4368,4368,4368,65315,65315,65315,4368,4368,0,0,0,0,0,0,0,0,0,0,4368,4368,4368,40224,40224,4368,65315,65315,40224,4368,40224,4368,0,0,0,0,0,0,0,0,40224,65315,65315,40224,40224,40224,40224,40224,40224,4368,4368,4368,0,0,0,0,0,0,0,4368,65315,65315,65315,40224,65315,40224,65315,65315,40224,40224,40224,4368,4368,0,0,0,0,0,40224,40224,4368,4368,40224,65315,65315,65315,65315,65315,40224,40224,40224,4368,4368,4368,0,0,4368,40224,40224,4368,4368,40224,40224,65315,16142,24327,16142,16142,16142,65315,65315,4368,40224,4368,0,0,0,4368,4368,4368,40224,40224,65315,16142,65315,16142,24327,16142,65315,65315,65315,40224,40224,4368,0,0,4368,40224,40224,40224,65315,16142,16142,16142,16142,24327,16142,24327,16142,65315,65315,40224,4368,4368,0,0,4368,4368,40224,40224,65315,16142,24327,24327,16142,24327,24327,16142,24327,40224,40224,40224,40224,4368,0,0,4368,4368,4368,40224,65315,16142,40224,65315,16142,16142,65315,16142,65315,65315,40224,40224,65315,4368,0,0,4368,40224,40224,40224,65315,65315,16142,24327,65315,16142,16142,65315,65315,40224,40224,40224,65315,4368,0,0,0,4368,40224,40224,40224,4368,40224,40224,40224,40224,40224,65315,40224,40224,40224,4368,65315,65315,0,0,0,0,4368,40224,4368,65315,65315,65315,65315,40224,40224,40224,40224,40224,40224,40224,65315,4368,0,0,0,4368,40224,40224,40224,4368,65315,40224,40224,4368,4368,40224,40224,40224,40224,4368,0,4368,0,0,0,4368,4368,40224,40224,4368,4368,4368,40224,40224,4368,4368,4368,40224,4368,4368,0,0,0,0,0,0,0,0,0,4368,4368,40224,4368,40224,4368,4368,4368,4368,4368,0,0,0,0,0,0,0,0,0,0,0,0,4368,4368,4368,0,0,4368,4368,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
};
const uint16_t poof2[]=
{
	528,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,768,0,0,1544,4368,4368,4368,4368,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1544,4368,4368,4368,4368,4368,4368,40224,4368,4368,4368,0,4368,4368,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4368,59144,4368,4368,4368,4368,4368,4368,40224,4368,4368,4368,4368,4368,4368,4368,4368,4368,0,0,528,0,0,0,0,0,0,0,0,4368,4368,4368,4368,4368,40224,40224,40224,40224,40224,4368,40224,40224,4368,40224,40224,40224,4368,4368,4368,4368,0,0,0,0,0,0,0,0,4368,40224,4368,4368,4368,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,4368,4368,4368,4368,0,0,0,0,0,0,0,0,4368,4368,4368,4368,40224,40224,40224,65315,40224,40224,40224,40224,40224,65315,65315,40224,40224,40224,40224,4368,40224,4368,0,0,0,0,0,0,0,4368,4368,4368,4368,40224,40224,40224,40224,65315,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,4368,40224,4368,0,0,0,0,0,0,4368,40224,4368,4368,40224,40224,40224,40224,65315,65315,65315,16142,65315,24327,65315,65315,40224,40224,40224,40224,40224,40224,4368,4368,4368,0,0,0,0,0,4368,4368,4368,40224,65315,40224,40224,65315,65315,65315,16142,65315,16142,24327,65315,65315,65315,24327,65315,40224,40224,40224,40224,4368,4368,0,0,0,0,0,4368,4368,4368,40224,40224,40224,40224,65315,24327,65315,24327,24327,24327,24327,24327,65315,65315,24327,65315,40224,40224,40224,4368,4368,4368,0,0,0,0,0,4368,4368,4368,40224,40224,65315,65315,65315,65315,24327,24327,16142,24327,16142,24327,24327,65315,65315,65315,65315,40224,40224,4368,4368,40224,0,0,0,0,4368,4368,40224,4368,40224,40224,40224,65315,65315,24327,24327,24327,24327,24327,16142,24327,24327,65315,65315,65315,65315,4368,40224,4368,4368,40224,0,0,0,0,65315,4368,40224,4368,40224,65315,65315,65315,65315,24327,16142,16142,16142,16142,24327,24327,24327,65315,24327,65315,65315,4368,40224,4368,4368,4368,0,0,0,0,0,4368,4368,40224,40224,40224,65315,65315,65315,24327,16142,16142,16142,16142,24327,16142,24327,65315,65315,65315,40224,40224,40224,40224,40224,4368,0,0,0,0,4368,4368,4368,40224,40224,65315,65315,65315,65315,24327,24327,16142,16142,16142,24327,24327,24327,65315,65315,65315,40224,40224,40224,40224,4368,0,0,0,0,0,4368,4368,4368,4368,40224,40224,40224,65315,24327,24327,24327,24327,16142,16142,24327,65315,24327,65315,65315,40224,40224,40224,40224,4368,4368,0,0,0,0,0,4368,4368,4368,4368,65315,40224,65315,65315,65315,65315,16142,24327,16142,24327,24327,24327,65315,65315,65315,65315,40224,40224,40224,40224,4368,0,0,0,0,0,0,4368,4368,4368,40224,65315,40224,65315,65315,65315,65315,24327,16142,24327,24327,65315,65315,65315,65315,4368,40224,40224,4368,40224,4368,0,0,0,0,0,0,4368,40224,4368,40224,40224,40224,40224,40224,65315,65315,24327,65315,24327,24327,65315,40224,40224,65315,40224,40224,40224,4368,4368,4368,0,0,0,0,0,0,4368,4368,40224,4368,40224,40224,40224,40224,40224,65315,24327,65315,65315,65315,40224,65315,65315,40224,40224,4368,4368,4368,4368,4368,0,0,0,0,0,0,4368,4368,4368,4368,4368,40224,40224,65315,40224,65315,65315,65315,65315,40224,40224,40224,65315,40224,40224,40224,4368,4368,4368,0,0,0,0,0,0,0,17953,4368,4368,4368,4368,4368,40224,4368,40224,40224,40224,40224,40224,40224,40224,40224,40224,4368,4368,4368,4368,40224,4368,0,0,0,0,0,0,0,0,4368,4368,40224,40224,4368,4368,40224,40224,65315,4368,40224,40224,4368,4368,4368,40224,4368,4368,40224,4368,0,0,0,0,0,0,0,0,0,0,0,0,4368,4368,4368,40224,4368,4368,4368,40224,4368,4368,4368,40224,4368,40224,4368,0,4368,0,0,0,0,0,0,0,0,0,0,0,0,0,4368,4368,4368,4368,4368,40224,4368,4368,4368,4368,4368,4368,4368,0,4368,4368,4368,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4368,4368,4368,0,4368,4368,4368,256,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
};
const uint16_t poof3[]=
{
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4368,0,1024,3600,4368,4368,4368,4368,3600,1544,0,4368,4368,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1024,4368,4368,4368,4368,4368,4368,4368,4368,4368,4112,4368,4368,3600,3600,1544,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4368,0,0,1024,3600,4368,4368,4368,4368,4368,4368,4368,4368,4368,4368,40224,4368,4112,4112,4368,4368,4112,1544,4368,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4368,0,3856,4368,4368,4368,4368,4368,4368,4368,4368,4368,4368,4368,4368,4368,4368,4368,4368,4368,4368,4112,1544,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4368,0,1024,4368,3856,4368,4368,4368,4368,4368,4368,40224,40224,4368,4368,4368,4368,4368,4368,4368,4368,4368,4368,4368,4368,4368,2056,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4368,4112,4368,4368,4368,4368,4368,4368,40224,40224,4368,40224,4368,4368,40224,4368,4368,4368,4368,4368,4368,4368,4368,4368,4368,4368,4368,1544,0,4368,0,0,0,0,0,0,0,0,4368,4368,3856,4368,4368,4368,4368,40224,4368,40224,40224,4368,4368,29976,4368,40224,40224,4368,40224,65315,30232,65315,4368,4368,4368,4368,4368,4368,4368,4112,0,0,0,0,0,0,0,0,0,0,4368,4368,4368,4368,4368,40224,4368,4368,4368,4368,4368,29976,40224,16142,40224,40224,4368,4368,40224,65315,65315,65315,65315,29976,4368,4368,4368,4368,4368,4368,4368,0,0,0,0,0,0,0,0,1024,3600,4368,4368,4368,4368,65315,4368,4368,4368,37648,40224,40224,40224,40224,40224,40224,40224,40224,40224,4368,4368,4368,4368,65315,40224,4368,4368,4368,4368,4112,1544,0,0,0,0,0,0,0,0,3856,4368,4368,4368,4368,4368,4368,40224,5144,31776,40224,40224,40224,65315,48416,40224,40224,65315,40224,40224,40224,40224,40224,40224,4368,65315,65315,4368,4368,4368,4368,4368,0,0,0,0,0,0,0,1544,4368,4368,4368,4368,65315,65315,40224,65315,40224,16142,40224,40224,40224,7713,65315,65315,65315,32547,15906,40224,65315,40224,40224,4368,4368,40224,29976,4368,4368,4368,4368,4368,4368,0,0,0,0,0,0,3856,4368,4368,4368,4368,4368,65315,23584,40224,40224,65315,65315,7713,57123,65315,40224,65315,65315,65315,65315,32547,15906,40224,40224,40224,40224,40224,32032,4368,4368,4368,4368,4368,4368,0,0,0,0,0,0,4368,4368,4368,4368,40224,4368,40224,65315,40224,40224,40224,40482,57123,65315,65315,24327,65315,24327,65315,65315,40224,40739,15906,40224,40224,40224,40224,40224,40224,4368,4368,4368,4368,1544,4368,0,0,0,0,0,4368,4368,4368,4368,65315,30232,40224,40224,40224,40224,40482,65315,24327,24327,24327,40711,24327,40711,24349,65315,65315,65315,40224,15906,40224,65315,40224,40224,46616,4368,4368,4368,4368,4112,4368,0,0,0,0,0,4368,4368,4368,4368,4368,15392,40224,40224,40224,7713,65315,65315,24327,65308,32519,24327,24327,24327,57095,48917,65315,24327,65315,40224,40224,16142,40224,40224,32032,4368,4368,4368,4368,4368,0,0,0,0,0,0,4112,4368,4368,65315,65315,40224,40224,40224,40224,57123,40224,65315,65308,32519,24327,24327,16142,24327,16142,24327,7957,65315,24327,65315,65315,65315,40224,16142,40224,4368,4368,4368,4368,4368,0,0,0,0,0,0,2824,4368,4368,40224,30232,40224,40224,40224,65315,65315,40224,65315,65287,24327,24327,16142,16142,16142,24327,24327,24327,40725,65315,65315,57123,40224,16142,16142,40224,4368,4368,4368,4368,4368,0,0,0,0,4368,4368,3856,4368,4368,65315,15392,40224,40224,16142,40224,40224,65315,65315,16142,24327,16142,24327,16142,24327,16142,16142,24327,57095,24327,65315,40224,64800,40224,40224,40224,4368,65315,4368,4368,4368,0,0,0,0,0,4368,4368,4368,40224,40224,40224,40224,40224,40224,40224,65315,65315,24327,16142,24327,16142,16142,16142,24327,16142,24327,24327,24327,65315,65315,65315,65315,40224,40224,40224,4368,4368,4368,4368,4368,0,0,0,0,0,4368,4368,4368,4368,40224,40224,40224,40224,16142,40224,65315,24327,65315,24327,16142,16142,24327,16142,16142,16142,16142,16142,24327,65315,65315,65315,40224,40224,40224,22808,4368,4368,4368,4368,3088,0,0,0,0,0,0,4368,4368,4368,4368,65315,40224,40224,40224,65315,40739,65315,65315,57095,24327,16142,24327,16142,24327,24327,24327,24327,40726,24327,65315,40224,40224,40224,16142,12560,4368,65315,4368,4368,4112,0,0,0,0,0,0,4112,4368,4368,4368,40224,40224,40224,40224,40224,32290,65315,65315,7958,24327,24327,24327,16142,16142,24327,24327,40726,65315,65315,65315,64800,40224,40224,40224,4368,4368,65315,4368,4368,4368,4368,0,0,0,0,0,3856,40224,40224,4368,32032,65315,40224,40224,40224,64800,16163,40224,32548,65294,24327,24327,24327,24327,24327,40726,65315,24327,65315,48673,40224,65315,40224,40224,4368,65315,65315,4368,4368,4368,4368,0,0,0,0,4368,4368,4368,4368,4368,40224,40224,16142,40224,40224,65315,64800,40224,24327,65315,65315,24327,24327,24356,65315,65315,65315,65315,65315,40224,40224,40224,40224,40224,4368,4368,4368,4368,4368,2824,0,0,0,0,0,4368,4368,4368,4368,4368,40224,6168,40224,40224,40224,40224,65315,40224,40739,65315,24327,24327,24327,24327,65315,24327,65315,65315,57122,65315,40224,40224,16142,14360,4368,65315,4368,4368,3080,4368,0,4368,0,0,0,4368,4112,4368,4368,4368,4368,12560,65315,40224,40224,40224,65315,40224,40224,32290,65315,65315,65315,65315,65315,65315,48930,64800,40224,40224,40224,40224,65315,4368,4368,65315,4368,4368,0,0,0,0,0,0,0,0,2056,4368,4368,4368,40224,4368,65315,65315,65315,40224,40224,65315,40224,40224,40224,65315,40224,65315,40224,40224,65315,65315,40224,65315,40224,65315,4368,40224,4368,4368,4368,4368,4368,0,0,0,0,0,0,0,4368,4368,4368,4368,4368,4368,46616,40224,40224,65315,40224,40224,40224,40224,40224,40224,40224,40224,65315,40224,40224,40224,40224,40224,40224,12560,4368,4368,4368,4368,4368,4368,0,0,0,0,0,0,0,4368,4368,4368,4112,4368,4368,4368,40224,12560,22552,40224,40224,40224,16142,65315,40224,65315,65315,40224,40224,40224,40224,40224,40224,65315,14360,16142,4368,4368,4368,4368,4368,3600,0,0,0,0,0,0,0,0,0,0,2312,4368,4368,4368,4368,4368,4368,4368,4368,46616,40224,40224,40224,40224,40224,40224,40224,40224,40224,16142,40224,40224,65315,4368,4368,4368,4368,4368,4368,0,0,0,0,0,0,0,0,0,0,0,4368,4368,4368,4368,4368,40224,4368,40224,4368,4368,65315,40224,40224,40224,40224,40224,22808,12560,65315,40224,40224,4368,40224,4368,4368,4368,4368,4368,3600,0,0,0,0,0,0,0,0,0,0,0,4368,0,2056,4368,4368,4368,4368,4368,4368,4368,4368,40224,40224,4368,65315,65315,65315,4368,40224,4368,4368,4368,4368,4368,4368,4368,4368,4368,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4368,4368,4368,4368,4368,4368,4368,4368,40224,4368,4368,40224,65315,4368,40224,4368,4368,4368,4368,4368,4368,4368,4368,2824,0,0,0,0,0,0,0,0,0,0,0,0,0,4368,4368,0,0,0,3080,4368,4368,4368,4368,4368,4368,4368,4368,4368,4368,4368,4368,4368,4368,4368,4368,4368,4368,4368,4368,0,4368,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4368,4368,0,2056,4368,4368,4368,4368,4368,4368,4368,4368,4368,4112,4368,4368,4368,4368,4368,4368,4368,4368,2568,4368,4368,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4368,0,0,4368,4368,4368,4368,0,3080,3344,0,2056,4368,4368,2824,0,0,0,4368,0,4368,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4368,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
};
const uint16_t cheese[]=
{
	58368,58368,58368,58368,58368,58368,58368,58368,0,0,0,58368,58368,58368,58368,58368,58368,58368,58368,58368,58368,0,0,65391,65391,65391,0,58368,58368,58368,58368,58368,58368,58368,0,0,65391,65391,65391,65315,65315,65391,0,58368,58368,58368,58368,0,0,65391,65391,65391,65391,65391,65391,65391,65391,65391,0,58368,58368,0,65391,65315,65391,65315,65315,65391,65391,65391,65315,29722,65391,65391,0,0,65391,65391,65391,65391,65315,29722,65391,65391,65391,65391,65391,65391,65391,0,0,0,0,0,0,0,65315,0,0,13322,13322,13322,65324,0,0,0,65391,65391,65391,65391,65324,65324,65324,65324,65315,13322,65324,65324,65324,0,0,65391,65315,65391,65391,65324,65324,65324,65324,65315,13322,13322,65315,65315,0,0,65391,65391,65391,65391,65324,65315,65315,65324,65324,13322,13322,65315,65315,0,58368,0,65391,65391,65391,65324,65315,65315,65324,65324,13322,13322,13322,13322,0,58368,0,65315,29722,65391,65324,65324,65324,65324,65324,13322,29722,65315,13322,0,0,65391,65315,65315,65391,65324,65324,65324,65324,65324,13322,65315,65315,13322,0,0,65391,65391,65391,65391,65324,65324,65324,65324,0,0,0,13322,13322,0,58368,0,0,0,0,0,0,0,0,58368,58368,58368,0,0,58368,
};


uint32_t tune1_notes[] = {GS4_Ab4,G4,GS5_Ab5,C4,DS4_Eb4,0,G4,GS4_Ab4,F4,0,F4,F4,G4,GS4_Ab4,AS4_Bb4,G4,F4,F4,G4,G4,0,C5,C5,0,F4,GS4_Ab4,0,GS4_Ab4,AS4_Bb4,0,GS4_Ab4,G4,F4,0,F4,DS5_Eb5,C5,CS5_Db5,C5,AS4_Bb4,0};
uint32_t tune1_times[] = {250,1750,250,750,2500,500,250,750,1500,750,750,250,750,250,1000,250,500,250,1000,1750,250,1250,500,250,500,1500,250,1000,334,333,333,500,500,250,750,3000,250,500,1250,500};

uint32_t tune2_notes[] = {F4,D4,0,C4,D4,F4,A4,A4,A4,A4,G4,G4,AS4_Bb4,0,G4,DS4_Eb4,0,D4,AS3_Bb3,D4,C4,0,F4,D4,0,C4,D4,F4,A4,G4,0,G4,A4,G4,0,G4,AS4_Bb4,0,AS4_Bb4,AS4_Bb4,0,AS4_Bb4,AS4_Bb4,FS4_Gb4,F4,FS4_Gb4,F4,FS4_Gb4,F4,D4,C4,D4,FS3_Gb3,AS3_Bb3,D4,D4,D4,C4,D4,F4,D4,D4,F4,A4,G4,0,AS3_Bb3,C4,AS3_Bb3,F4,0,AS4_Bb4,G4,0,F4,G4,F4,0,D4,D4,D4,0,A3,A3,0,AS3_Bb3,0};
uint32_t tune2_times[] = {500,500,834,166,334,166,500,334,166,334,500,166,500,334,166,166,334,334,166,500,500,500,500,500,834,166,334,166,334,166,450,50,334,166,334,166,166,166,166,166,166,166,334,166,334,166,500,500,500,334,166,334,500,166,334,166,334,166,500,500,500,334,166,334,166,834,166,334,166,500,1000,500,1000,334,166,334,166,666,166,166,166,166,166,166,166,666,1000};

uint32_t sound_win[] = {C5,F4,C5,D5};
uint32_t win_times[] = {300,300,300,1200};

uint32_t *notes;
uint32_t *note_times;
int tune_playing = 1;
int tune_index = 0;
int tune_time_remaining = 0;
int tune_repeat = 0;

int main()
{
	int hinverted = 0;
	int vinverted = 0;
	int toggle = 0; // For movements (change between sprites)
	int hmoved = 0;
	int vmoved = 0;
	uint16_t x = 0;
	uint16_t y = 0;
	uint16_t oldx = x;
	uint16_t oldy = y;
	initClock();
	initSerial();
	initSysTick();
	setupIO();
	initSound();


	// Variables to show whether the player has passed each level
	int level = 1;

	//grassmaze(); // Call Function to show level 1 (grass maze)

	while(1)
	{
		// Code for showing main menu
		// main_menu

		// If on level 1
		if (level == 1)
		{
			// Call Function to start Level 1 (grass maze)
			level = maze_level1(level);

			do
			{
				hmoved = vmoved = 0;
				hinverted = vinverted = 0;
				if ((GPIOB->IDR & (1 << 4))==0) // right pressed
				{					
					if (x < 112)
					{
						x = x + 1;
						hmoved = 1;
						hinverted=0;
					}						
				}
				if ((GPIOB->IDR & (1 << 5))==0) // left pressed
				{			
					
					if (x > 0)
					{
						x = x - 1;
						hmoved = 1;
						hinverted=1;
					}			
				}
				if ((GPIOA->IDR & (1 << 11)) == 0) // down pressed // down pressed
				{
					if (y < 144)
					{
						y = y + 1;			
						vmoved = 1;
						vinverted = 0;
					}
				}
				if ( (GPIOA->IDR & (1 << 8)) == 0) // up pressed
				{			
					if (y > 0)
					{
						y = y - 1;
						vmoved = 1;
						vinverted = 1;
					}
				}
				if ((vmoved) || (hmoved))
				{
					// only redraw if there has been some movement (reduces flicker)
					fillRectangle(oldx,oldy,16,16,RGBToWord(5,28,12));
					oldx = x;
					oldy = y;	

					if (hmoved)
					{
						
						// Change to Spite 1 of mouse (stationary)
						if (toggle == 0)
						{
							putImage(x,y,16,16,mouse1,hinverted,0);
							toggle++;
						}
						// Change to Sprite 2 of mouse (jumping)
						else if (toggle == 1)
						{
							putImage(x,y,16,16,mouse2,hinverted,0);
							toggle++;
						}
						// Change to Sprite 3 of mouse (landing)
						else
						{
							putImage(x,y,16,16,mouse3,hinverted,0);
							toggle = 0;
						}
					}
					else
					{
						// Change to sprite 1 of y-axis movements
						if (toggle == 0)
						{
							putImage(x,y,16,16,mousedown1,0,vinverted);
							toggle++;
						}
						// Change to sprite 2 of y-axis movements
						else 
						{
							putImage(x,y,16,16,mousedown2,0,vinverted);
							toggle = 0;
						}	
					}
				}		
				delay(50);
			}
			while (!((isInside(113,144,16,16,x,y) || isInside(113,144,16,16,x+16,y) || isInside(113,144,16,16,x,y+16) || isInside(113,144,16,16,x+16,y+16))));

			level = level1_pass(oldx,oldy,level);

			break;
		} // End if

		// If on level 2
		if (level == 2)
		{
			// Call Function to start level 2 ()
			//maze_level2();
		} // End If
		// If on level 3
		if (level == 3)
		{
			// Call Function to start level 3 (snow maze)
			//maze_level3;
		} // End If
	}

	return 0;
}

void initSysTick(void)
{
	SysTick->LOAD = 48000;
	SysTick->CTRL = 7;
	SysTick->VAL = 10;
	__asm(" cpsie i "); // enable interrupts
}
void SysTick_Handler(void)
{
	milliseconds++;
}
void initClock(void)
{
// This is potentially a dangerous function as it could
// result in a system with an invalid clock signal - result: a stuck system
        // Set the PLL up
        // First ensure PLL is disabled
        RCC->CR &= ~(1u<<24);
        while( (RCC->CR & (1 <<25))); // wait for PLL ready to be cleared
        
// Warning here: if system clock is greater than 24MHz then wait-state(s) need to be
// inserted into Flash memory interface
				
        FLASH->ACR |= (1 << 0);
        FLASH->ACR &=~((1u << 2) | (1u<<1));
        // Turn on FLASH prefetch buffer
        FLASH->ACR |= (1 << 4);
        // set PLL multiplier to 12 (yielding 48MHz)
        RCC->CFGR &= ~((1u<<21) | (1u<<20) | (1u<<19) | (1u<<18));
        RCC->CFGR |= ((1<<21) | (1<<19) ); 

        // Need to limit ADC clock to below 14MHz so will change ADC prescaler to 4
        RCC->CFGR |= (1<<14);

        // and turn the PLL back on again
        RCC->CR |= (1<<24);        
        // set PLL as system clock source 
        RCC->CFGR |= (1<<1);
}
void delay(volatile uint32_t dly)
{
	uint32_t end_time = dly + milliseconds;
	while(milliseconds != end_time)
		__asm(" wfi "); // sleep
}

void enablePullUp(GPIO_TypeDef *Port, uint32_t BitNumber)
{
	Port->PUPDR = Port->PUPDR &~(3u << BitNumber*2); // clear pull-up resistor bits
	Port->PUPDR = Port->PUPDR | (1u << BitNumber*2); // set pull-up bit
}
void pinMode(GPIO_TypeDef *Port, uint32_t BitNumber, uint32_t Mode)
{
	/*
	*/
	uint32_t mode_value = Port->MODER;
	Mode = Mode << (2 * BitNumber);
	mode_value = mode_value & ~(3u << (BitNumber * 2));
	mode_value = mode_value | Mode;
	Port->MODER = mode_value;
}
int isInside(uint16_t x1, uint16_t y1, uint16_t w, uint16_t h, uint16_t px, uint16_t py)
{
	// checks to see if point px,py is within the rectange defined by x,y,w,h
	uint16_t x2,y2;
	x2 = x1+w;
	y2 = y1+h;
	int rvalue = 0;
	if ( (px >= x1) && (px <= x2))
	{
		// ok, x constraint met
		if ( (py >= y1) && (py <= y2))
			rvalue = 1;
	}
	return rvalue;
}

void setupIO()
{
	RCC->AHBENR |= (1 << 18) + (1 << 17); // enable Ports A and B
	display_begin();
	pinMode(GPIOB,4,0);
	pinMode(GPIOB,5,0);
	pinMode(GPIOA,8,0);
	pinMode(GPIOA,11,0);
	enablePullUp(GPIOB,4);
	enablePullUp(GPIOB,5);
	enablePullUp(GPIOA,11);
	enablePullUp(GPIOA,8);
}

// Function to set display to level 1 (grass maze)
int maze_level1(int level)
{
    // Set Background Colour
    fillRectangle(0,0,SCREEN_WIDTH,SCREEN_HEIGHT,RGBToWord(5,28,12));

    // Put mouse and cheese on spawn points
    putImage(0,0,16,16,mouse1,0,0);
	putImage(113,145,15,15,cheese,0,0);

    // Set Lines for maze borders 
    // Vertical Line Set
    drawLine(18,159,18,121,0);
    drawLine(104,138,104,159,0);
    drawLine(69,104,69,138,0);
    drawLine(52,86,52,159,0);
    drawLine(18,104,18,86,0);
    drawLine(35,18,35,35,0);
    drawLine(35,52,35,104,0);
    drawLine(52,0,52,69,0);
    drawLine(69,0,69,18,0);
    drawLine(87,18,87,52,0);
    drawLine(121,52,121,104,0);
    drawLine(104,18,104,35,0);
    drawLine(69,52,69,86,0);
    drawLine(104,69,104,104,0);
    drawLine(87,86,87,104,0);
    drawLine(69,104,69,138,0);
    drawLine(87,121,87,138,0);

    // Horizontal Line Set
    drawLine(18,121,35,121,0);
    drawLine(35,138,52,138,0);
    drawLine(0,104,18,104,0);
    drawLine(0,52,18,52,0);
    drawLine(0,18,35,18,0);
    drawLine(18,35,35,35,0);
    drawLine(18,69,52,69,0);
    drawLine(52,35,69,35,0);
    drawLine(87,52,121,52,0);
    drawLine(104,18,127,18,0);
    drawLine(104,35,112,35,0);
    drawLine(52,86,69,86,0);
    drawLine(69,69,104,69,0);
    drawLine(69,104,87,104,0);
    drawLine(69,138,87,138,0);
    drawLine(87,121,127,121,0);
    drawLine(69,138,87,138,0);

	level = 0;

	return level;
} // End Function

/*
// Function to set display to level 2 ()
void maze_level2(void)
{
	// Set Background Colour
    fillRectangle(0,0,SCREEN_WIDTH,SCREEN_HEIGHT,RGBToWord(5,28,12));

} // End Function

// Function to set display to level 3 (snow maze)
void maze_level3(void)
{
	// Set Background Colour
    fillRectangle(0,0,SCREEN_WIDTH,SCREEN_HEIGHT,RGBToWord(5,28,12));
	
} // End Function
*/

// Function that runs when the player is on level 1 and eats the cheese
int level1_pass(uint16_t oldx, uint16_t oldy, int level)
{
	// Play win sound
	for (int i = 0; i < 4; i++)
	{
		playNote(sound_win[i]);
		delay(win_times[i]);
	}

	playNote(0);

	// Set level to 2
	level = 2;

	// Turn On First LED (level 1 passed)

	// Print SHABOOYAH
	printTextX2("SHABOOYAH", 11, 20, RGBToWord(188,0,255), RGBToWord(5,28,12));

	// Cover old image of mouse
	fillRectangle(oldx,oldy,16,16,RGBToWord(10,51,22));

	// Play explosion animation
	for (int i = 0; i < 4; i++)
	{
		fillRectangle(86,120,44,40,0x0000);

		delay(600);

		putImage(111,145,15,15,poof0,0,0);

		delay(300);

		putImage(106,140,20,20,poof1,0,0);

		delay(300);

		putImage(96,130,30,30,poof2,0,0);

		delay(300);

		putImage(86,120,40,40,poof3,0,0);

		delay(300);
	} // End For

	// return new level
	return level;
} // End Function

/*
// Function that runs when the player is on level 2 and eats the cheese
int level2_pass(uint16_t oldx,uint16_t oldy, int level)
{
	// Play win sound

	// Set level to 3
	level = 3;

	// Turn On Second LED (level 2 passed)

	// Print SHABOOYAH
	printTextX2("SHABOOYAH", 11, 20, RGBToWord(188,0,255), RGBToWord(10,51,22));

	// Cover old image of mouse
	fillRectangle(oldx,oldy,16,16,RGBToWord(10,51,22));

	// Play explosion animation
	for (int i = 0; i < 20; i++)
	{
		fillRectangle(76,108,40,40,0x0000);

		delay(600);

		putImage(113,145,15,15,poof0,0,0);

		delay(300);

		putImage(111,143,20,20,poof1,0,0);

		delay(300);

		putImage(109,141,30,30,poof2,0,0);

		delay(300);

		putImage(107,139,40,40,poof3,0,0);

		delay(300);
	} // End For

	// return new level
	return level;
} // End Function

// Function that runs when the player is on level 2 and eats the cheese
void level3_pass(uint16_t oldx, uint16_t oldy)
{
	// Play win sound
	
	// Turn On Second LED (level 2 passed)

	// Print SHABOOYAH
	printTextX2("SHABOOYAH", 11, 20, RGBToWord(188,0,255), RGBToWord(10,51,22));

	// Cover old image of mouse
	fillRectangle(oldx,oldy,16,16,RGBToWord(10,51,22));

	// Play explosion animation
	for (int i = 0; i < 20; i++)
	{
		fillRectangle(76,108,40,40,0x0000);

		delay(600);

		putImage(113,145,15,15,poof0,0,0);

		delay(300);

		putImage(111,143,20,20,poof1,0,0);

		delay(300);

		putImage(109,141,30,30,poof2,0,0);

		delay(300);

		putImage(107,139,40,40,poof3,0,0);

		delay(300);
	} // End For

	// Display a victory message
	// Make lights flash like crazy
	// Play music

} // End Function
*/

/*
	To Do: 
	
	1. Win sounds
	2. Each level start code
	3. Each level win code
	4. Victory Message / Screen
	5. Border collisions
	6. Music 
	7. LED code
	8. Easter Eggs
	9. Serial Port Use
*/